/*
 * Copyright 2022-2025 openDAQ d.o.o.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
//
//     RTGen (CSharpGenerator v1.0.0) on 03.02.2026 08:33:13.
// </auto-generated>
//------------------------------------------------------------------------------


using Daq.Core.Types;
using Daq.Core.Objects;


namespace Daq.Core.OpenDAQ;


[StructLayout(LayoutKind.Sequential)]
internal unsafe class RawSyncComponent2 : RawBaseObject
{
    //ErrorCode getSelectedSource(daq.ISyncInterface** selectedSource); stdcall;
    public delegate* unmanaged[Stdcall]<IntPtr, out IntPtr, ErrorCode> GetSelectedSource;
    //ErrorCode setSelectedSource(daq.IString* selectedSourceName); stdcall;
    public delegate* unmanaged[Stdcall]<IntPtr, IntPtr, ErrorCode> SetSelectedSource;
    //ErrorCode getSourceSynced(daq.Bool* synced); stdcall;
    public delegate* unmanaged[Stdcall]<IntPtr, out bool, ErrorCode> GetSourceSynced;
    //ErrorCode getSourceReferenceDomainId(daq.IString** referenceDomainId); stdcall;
    public delegate* unmanaged[Stdcall]<IntPtr, out IntPtr, ErrorCode> GetSourceReferenceDomainId;
    //ErrorCode getInterfaces(daq.IDict** interfaces); stdcall;
    public delegate* unmanaged[Stdcall]<IntPtr, out IntPtr, ErrorCode> GetInterfaces;
}

/// <summary>Interface representing a Synchronization Component 2 in a Test &amp; Measurement system.</summary>
[Guid("bbd876f5-ff0d-5126-bd64-98546b1dcbe3")]
public class SyncComponent2 : BaseObject
{
    //type-casted base._virtualTable
    private readonly RawSyncComponent2 _rawSyncComponent2;

    internal SyncComponent2(IntPtr nativePointer, bool incrementReference)
        : base(nativePointer, incrementReference)
    {
        IntPtr objVirtualTable = Marshal.ReadIntPtr(nativePointer, 0); //read the pointer from the given address
        base._virtualTable =
            _rawSyncComponent2 = Marshal.PtrToStructure<RawSyncComponent2>(objVirtualTable);
    }

    #region properties

    /// <summary>Retrieves the selected sync source interface.</summary>
    public SyncInterface SelectedSource
    {
        get
        {
            //native output argument
            IntPtr selectedSourcePtr;

            unsafe //use native function pointer
            {
                //call native function
                ErrorCode errorCode = (ErrorCode)_rawSyncComponent2.GetSelectedSource(base.NativePointer, out selectedSourcePtr);

                if (Result.Failed(errorCode))
                {
                    throw new OpenDaqException(errorCode);
                }
            }

            // validate pointer
            if (selectedSourcePtr == IntPtr.Zero)
            {
                return default;
            }

            return new SyncInterface(selectedSourcePtr, incrementReference: false);
        }
    }

    /// <summary>Gets whether the source is synced.</summary>
    public bool SourceSynced
    {
        get
        {
            //native output argument
            bool synced;

            unsafe //use native function pointer
            {
                //call native function
                ErrorCode errorCode = (ErrorCode)_rawSyncComponent2.GetSourceSynced(base.NativePointer, out synced);

                if (Result.Failed(errorCode))
                {
                    throw new OpenDaqException(errorCode);
                }
            }

            return synced;
        }
    }

    /// <summary>Gets the reference domain ID of the source.</summary>
    public string SourceReferenceDomainId
    {
        get
        {
            //native output argument
            IntPtr referenceDomainIdPtr;

            unsafe //use native function pointer
            {
                //call native function
                ErrorCode errorCode = (ErrorCode)_rawSyncComponent2.GetSourceReferenceDomainId(base.NativePointer, out referenceDomainIdPtr);

                if (Result.Failed(errorCode))
                {
                    throw new OpenDaqException(errorCode);
                }
            }

            // validate pointer
            if (referenceDomainIdPtr == IntPtr.Zero)
            {
                return default;
            }

            using var referenceDomainId = new StringObject(referenceDomainIdPtr, incrementReference: false);
            return referenceDomainId;
        }
    }

    /// <summary>Retrieves the dictionary of interfaces associated with this synchronization component.</summary>
    public IDictObject<StringObject, SyncInterface> Interfaces
    {
        get
        {
            //native output argument
            IntPtr interfacesPtr;

            unsafe //use native function pointer
            {
                //call native function
                ErrorCode errorCode = (ErrorCode)_rawSyncComponent2.GetInterfaces(base.NativePointer, out interfacesPtr);

                if (Result.Failed(errorCode))
                {
                    throw new OpenDaqException(errorCode);
                }
            }

            // validate pointer
            if (interfacesPtr == IntPtr.Zero)
            {
                return default;
            }

            return new DictObject<StringObject, SyncInterface>(interfacesPtr, incrementReference: false);
        }
    }

    #endregion properties

    #region methods

    /// <summary>Sets the selected sync source interface by name.</summary>
    /// <param name="selectedSourceName">The name of the selected sync source interface.</param>
    public void SetSelectedSource(string selectedSourceName)
    {
        //cast .NET argument to SDK object
        using var selectedSourceNamePtr = (StringObject)selectedSourceName;

        unsafe //use native method pointer
        {
            //call native method
            ErrorCode errorCode = (ErrorCode)_rawSyncComponent2.SetSelectedSource(base.NativePointer, selectedSourceNamePtr);

            if (Result.Failed(errorCode))
            {
                throw new OpenDaqException(errorCode);
            }
        }
    }

    #endregion methods
}


#region Class Factory

// Factory functions of the &apos;OpenDAQ&apos; library.
public static partial class OpenDAQFactory
{
    //ErrorCode createSyncComponent2(daq.ISyncComponent2** obj, daq.IContext* context, daq.IComponent* parent, daq.IString* localId, daq.IString* className, daq.IString* name, daq.Bool registerEvents); cdecl;
    [DllImport(OpenDAQDllInfo.FileName, CallingConvention = CallingConvention.Cdecl)]
    private static extern ErrorCode createSyncComponent2(out IntPtr obj, IntPtr context, IntPtr parent, IntPtr localId, IntPtr className, IntPtr name, bool registerEvents);

    public static ErrorCode CreateSyncComponent2(out SyncComponent2 obj, Context context, Component parent, string localId, string className, string name, bool registerEvents)
    {
        //initialize output argument
        obj = default;

        //native output argument
        IntPtr objPtr;

        //cast .NET argument to SDK object
        using var localIdPtr = (StringObject)localId;
        using var classNamePtr = (StringObject)className;
        using var namePtr = (StringObject)name;

        //call native function
        ErrorCode errorCode = createSyncComponent2(out objPtr, context, parent, localIdPtr, classNamePtr, namePtr, registerEvents);

        if (Result.Succeeded(errorCode))
        {
            //create object
            obj = new SyncComponent2(objPtr, incrementReference: false);
        }

        return errorCode;
    }

    public static SyncComponent2 CreateSyncComponent2(Context context, Component parent, string localId, string className, string name, bool registerEvents)
    {
        //native output argument
        IntPtr objPtr;

        //cast .NET argument to SDK object
        using var localIdPtr = (StringObject)localId;
        using var classNamePtr = (StringObject)className;
        using var namePtr = (StringObject)name;

        //call native function
        ErrorCode errorCode = createSyncComponent2(out objPtr, context, parent, localIdPtr, classNamePtr, namePtr, registerEvents);

        if (Result.Failed(errorCode))
        {
            throw new OpenDaqException(errorCode);
        }

        //create and return object
        return new SyncComponent2(objPtr, incrementReference: false);
    }
}

#endregion Class Factory
